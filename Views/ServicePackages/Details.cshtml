@model ServiceMarketplace.Models.ServicePackage

@{
    ViewData["Title"] = Model.Name;
}

<!-- Breadcrumb -->
<div class="spd-breadcrumb">
    <a asp-action="Index" class="spd-breadcrumb-link">Paketler</a>
    <span class="spd-breadcrumb-sep">‚Ä∫</span>
    <a asp-action="Index" class="spd-breadcrumb-link">@Model.MainCategory.Name</a>
    <span class="spd-breadcrumb-sep">‚Ä∫</span>
    <span class="spd-breadcrumb-current">@Model.Code</span>
</div>

<!-- Main Content: 2-column layout -->
<div class="row g-4">
    <!-- Left Column -->
    <div class="col-lg-7 col-xl-8">

        <!-- Package Title -->
        <div class="mb-4">
            <span class="spd-code-badge">@Model.Code</span>
            <h1 class="spd-title">@Model.Name</h1>
        </div>

        <!-- Images -->
        <div class="spd-images-grid mb-4">
            @if (!string.IsNullOrEmpty(Model.ThumbnailImage))
            {
                <div class="spd-image-card">
                    <img src="@Model.ThumbnailImage" alt="@Model.Name" />
                    <div class="spd-image-overlay"></div>
                </div>
            }
            else
            {
                <div class="spd-image-card">
                    <img src="https://images.unsplash.com/photo-1556909114-f6e7ad7d3136?w=600&h=400&fit=crop" alt="@Model.Name 1" />
                    <div class="spd-image-overlay"></div>
                </div>
                <div class="spd-image-card">
                    <img src="https://images.unsplash.com/photo-1556909172-54557c7e4fb7?w=600&h=400&fit=crop" alt="@Model.Name 2" />
                    <div class="spd-image-overlay"></div>
                </div>
            }
        </div>

        <!-- Floor Plan SVG -->
        <div class="spd-floorplan-card mb-4">
            <svg width="260" height="160" viewBox="0 0 260 160">
                <rect x="10" y="10" width="240" height="140" fill="none" stroke="#cbd5e1" stroke-width="2" rx="4" stroke-dasharray="6 3" />
                <rect x="20" y="20" width="60" height="30" fill="#3b82f6" opacity="0.15" stroke="#3b82f6" stroke-width="1.5" rx="3" />
                <text x="50" y="39" text-anchor="middle" font-size="9" fill="#3b82f6" font-weight="600">Dolap</text>
                <rect x="100" y="20" width="80" height="20" fill="#f97316" opacity="0.15" stroke="#f97316" stroke-width="1.5" rx="3" />
                <text x="140" y="34" text-anchor="middle" font-size="9" fill="#f97316" font-weight="600">Tezgah</text>
                <rect x="20" y="70" width="220" height="70" fill="#10b981" opacity="0.08" stroke="#10b981" stroke-width="1.5" rx="3" stroke-dasharray="4 2" />
                <text x="130" y="110" text-anchor="middle" font-size="9" fill="#10b981" font-weight="600">Seramik Alanƒ±</text>
                <line x1="20" y1="152" x2="240" y2="152" stroke="#94a3b8" stroke-width="1" />
                <text x="130" y="148" text-anchor="middle" font-size="8" fill="#64748b">Geni≈ülik</text>
                <line x1="252" y1="20" x2="252" y2="140" stroke="#94a3b8" stroke-width="1" />
                <text x="248" y="85" text-anchor="middle" font-size="8" fill="#64748b" transform="rotate(-90 248 85)">Y√ºkseklik</text>
            </svg>
            <p class="spd-floorplan-caption">Karikat√ºr Mutfak ‚Äì √ñl√ß√º ≈ûemasƒ±</p>
        </div>

        <!-- Description -->
        <p class="spd-description">@Model.Description</p>

        <!-- Package Content -->
        <div class="spd-content-card">
            <h3 class="spd-content-title">
                <span class="spd-content-icon">üì¶</span>
                Paket ƒ∞√ßeriƒüi
            </h3>
            <div class="spd-items-list">
                @{ var items = Model.Items.OrderBy(i => i.DisplayOrder).ToList(); }
                @for (int i = 0; i < items.Count; i++)
                {
                    var item = items[i];
                    var isLast = i == items.Count - 1;
                    <div class="spd-item @(isLast ? "" : "spd-item-bordered")">
                        <div class="spd-item-dot @(item.ItemType == "Material" ? "spd-dot-material" : "spd-dot-labor")"></div>
                        <span class="spd-item-name">@item.Name</span>
                        <span class="spd-item-badge @(item.ItemType == "Material" ? "spd-badge-material" : "spd-badge-labor")">
                            @(item.ItemType == "Material" ? "Malzeme" : "ƒ∞≈ü√ßilik")
                        </span>
                    </div>
                }
            </div>
        </div>
    </div>

    <!-- Right Column - Calculator (sticky) -->
    <div class="col-lg-5 col-xl-4">
        <div class="spd-sidebar-sticky">

            <!-- Measurement Input Card -->
            <div class="spd-calc-card mb-3">
                <h3 class="spd-calc-title">
                    Mutfak √ñl√ß√ºleri <span class="spd-calc-unit">(cm)</span>
                </h3>
                <div class="row g-2">
                    <div class="col-4">
                        <label class="spd-input-label">GENƒ∞≈ûLƒ∞K</label>
                        <input type="number" id="spdWidth" class="spd-input spd-input-blue" value="320" />
                    </div>
                    <div class="col-4">
                        <label class="spd-input-label">Y√úKSEKLƒ∞K</label>
                        <input type="number" id="spdHeight" class="spd-input spd-input-purple" value="420" />
                    </div>
                    <div class="col-4">
                        <label class="spd-input-label">DERƒ∞NLƒ∞K</label>
                        <input type="number" id="spdDepth" class="spd-input spd-input-green" value="260" />
                    </div>
                </div>
            </div>

            <!-- Metrics Card -->
            <div class="spd-metrics-card mb-3" id="metricsCard">
                <h4 class="spd-metrics-title">
                    <span>üìê</span> Tahmini Metraj (Referans)
                </h4>
                <div class="spd-metrics-list">
                    <div class="spd-metric-row">
                        <span class="spd-metric-label">Dolap Alanƒ±:</span>
                        <span class="spd-metric-value spd-color-blue">
                            <span id="metricDolap">0</span> <span class="spd-metric-unit">m¬≤</span>
                        </span>
                    </div>
                    <div class="spd-metric-row">
                        <span class="spd-metric-label">Tezgah Uzunluƒüu:</span>
                        <span class="spd-metric-value spd-color-orange">
                            <span id="metricTezgah">0</span> <span class="spd-metric-unit">m</span>
                        </span>
                    </div>
                    <div class="spd-metric-row">
                        <span class="spd-metric-label">Seramik Alanƒ±:</span>
                        <span class="spd-metric-value spd-color-green">
                            <span id="metricSeramik">0</span> <span class="spd-metric-unit">m¬≤</span>
                        </span>
                    </div>
                </div>
                <p class="spd-metrics-disclaimer">
                    *Bu hesaplama bilgilendirme ama√ßlƒ±dƒ±r, kesin fiyat deƒüildir.
                </p>
            </div>

            <!-- CTA Button -->
            <a asp-controller="Listings" asp-action="CreateWithPackage" asp-route-packageId="@Model.Id"
               class="spd-cta-btn" id="ctaButton">
                TEKLƒ∞F AL
            </a>

            <!-- Trust Badges -->
            <div class="spd-trust-badges">
                <div class="spd-trust-item"><span>üîí</span> G√ºvenli</div>
                <div class="spd-trust-item"><span>‚ö°</span> Hƒ±zlƒ± Teklif</div>
                <div class="spd-trust-item"><span>‚úì</span> √úcretsiz</div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        (function () {
            const widthInput = document.getElementById('spdWidth');
            const heightInput = document.getElementById('spdHeight');
            const depthInput = document.getElementById('spdDepth');
            const metricDolap = document.getElementById('metricDolap');
            const metricTezgah = document.getElementById('metricTezgah');
            const metricSeramik = document.getElementById('metricSeramik');
            const metricsCard = document.getElementById('metricsCard');

            function calculateMetrics() {
                const w = parseFloat(widthInput.value) || 0;
                const h = parseFloat(heightInput.value) || 0;
                const d = parseFloat(depthInput.value) || 0;

                if (!w || !h || !d) {
                    metricsCard.style.opacity = '0.4';
                    metricDolap.textContent = '‚Äì';
                    metricTezgah.textContent = '‚Äì';
                    metricSeramik.textContent = '‚Äì';
                    return;
                }

                // Animate
                metricsCard.style.opacity = '0.5';
                metricsCard.style.transform = 'scale(0.98)';

                setTimeout(function () {
                    const dolapAlani = ((w + d * 2) * h) / 10000;
                    const tezgahUzunlugu = (w + d) / 100;
                    const seramikAlani = ((w * h + d * h * 2) * 1.1) / 10000;

                    metricDolap.textContent = dolapAlani.toFixed(1);
                    metricTezgah.textContent = tezgahUzunlugu.toFixed(1);
                    metricSeramik.textContent = seramikAlani.toFixed(1);

                    metricsCard.style.opacity = '1';
                    metricsCard.style.transform = 'scale(1)';
                }, 300);
            }

            // Debounced auto-calculate on input
            let debounceTimer;
            function onInputChange() {
                clearTimeout(debounceTimer);
                debounceTimer = setTimeout(calculateMetrics, 400);
            }

            widthInput.addEventListener('input', onInputChange);
            heightInput.addEventListener('input', onInputChange);
            depthInput.addEventListener('input', onInputChange);

            // Focus color effects
            widthInput.addEventListener('focus', function () { this.style.borderColor = '#3b82f6'; });
            widthInput.addEventListener('blur', function () { this.style.borderColor = '#e8ecf1'; });
            heightInput.addEventListener('focus', function () { this.style.borderColor = '#8b5cf6'; });
            heightInput.addEventListener('blur', function () { this.style.borderColor = '#e8ecf1'; });
            depthInput.addEventListener('focus', function () { this.style.borderColor = '#10b981'; });
            depthInput.addEventListener('blur', function () { this.style.borderColor = '#e8ecf1'; });

            // CTA hover effects
            const ctaBtn = document.getElementById('ctaButton');
            ctaBtn.addEventListener('mouseover', function () {
                this.style.transform = 'translateY(-2px)';
                this.style.boxShadow = '0 10px 32px rgba(249,115,22,0.45)';
            });
            ctaBtn.addEventListener('mouseout', function () {
                this.style.transform = 'translateY(0)';
                this.style.boxShadow = '0 6px 24px rgba(249,115,22,0.35)';
            });

            // Initial calculation
            calculateMetrics();
        })();
    </script>
}
